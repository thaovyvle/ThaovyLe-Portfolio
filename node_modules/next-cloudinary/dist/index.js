"use strict";var Le=Object.create;var $=Object.defineProperty;var ve=Object.getOwnPropertyDescriptor;var be=Object.getOwnPropertyNames;var Ne=Object.getPrototypeOf,Me=Object.prototype.hasOwnProperty;var We=(e,t)=>{for(var n in t)$(e,n,{get:t[n],enumerable:!0})},te=(e,t,n,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of be(t))!Me.call(e,o)&&o!==n&&$(e,o,{get:()=>t[o],enumerable:!(i=ve(t,o))||i.enumerable});return e};var h=(e,t,n)=>(n=e!=null?Le(Ne(e)):{},te(t||!e||!e.__esModule?$(n,"default",{value:e,enumerable:!0}):n,e)),De=e=>te($({},"__esModule",{value:!0}),e);var Ye={};We(Ye,{CldImage:()=>q,CldOgImage:()=>Q,CldUploadButton:()=>J,CldUploadWidget:()=>k,CldVideoPlayer:()=>Z,cloudinaryLoader:()=>Y,getCldImageUrl:()=>v,getCldOgImageUrl:()=>V,getCldVideoUrl:()=>Ue});module.exports=De(Ye);var b=h(require("react")),pe=h(require("next/image")),ce=require("@cloudinary-util/util"),ue=require("@cloudinary-util/url-loader");var re=h(require("next/package.json"));var oe={name:"next-cloudinary",version:"6.6.2",license:"MIT",main:"./dist/index.js",module:"./dist/index.mjs",types:"./dist/index.d.ts",source:"src/index.ts",scripts:{build:"tsup",dev:"tsup --watch",prepublishOnly:"cp ../README.md . && cp ../LICENSE . && pnpm build",postpublish:"rm ./README.md && rm ./LICENSE",test:"vitest run","test:app":'NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME="test" pnpm build && cd tests/nextjs-app && npm install && npm run build',"test:watch":"vitest"},dependencies:{"@cloudinary-util/types":"1.0.5","@cloudinary-util/url-loader":"5.3.1","@cloudinary-util/util":"^3.0.0","@tsconfig/recommended":"^1.0.3"},devDependencies:{"@babel/core":"^7.23.2","@babel/preset-env":"^7.23.2","@types/node":"^20.11.5","@types/react":"^18.2.33","@types/react-dom":"^18.2.14",dotenv:"^16.3.1",mkdirp:"^3.0.1",tsup:"^7.2.0",typescript:"^5.2.2",vitest:"^1.3.1"},peerDependencies:{next:"^12 || ^13 || ^14",react:"^17 || ^18"}};var ne="A",ie="V",de=le(re.default.version),ae=le(oe.version);function le(e){let t=e;return t.includes("-")&&(t=t.split("-")[0]),t}async function B(e){let{src:t}=e;try{await new Promise((n,i)=>{fetch(t).then(o=>{if(!o.ok){i(o);return}n(o)})})}catch(n){return n.status===423?(await new Promise(i=>setTimeout(()=>i(void 0),200)),await B(e)):!1}return!0}function L(e){let t=e?.cloud?.cloudName??process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME;if(!t)throw new Error("A Cloudinary Cloud name is required, please make sure NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME is set and configured in your environment.");let n=e?.cloud?.apiKey??process.env.NEXT_PUBLIC_CLOUDINARY_API_KEY,i=e?.url?.secureDistribution??process.env.NEXT_PUBLIC_CLOUDINARY_SECURE_DISTRIBUTION,o=e?.url?.privateCdn??process.env.NEXT_PUBLIC_CLOUDINARY_PRIVATE_CDN;return Object.assign({cloud:{...e?.cloud,apiKey:n,cloudName:t},url:{...e?.url,secureDistribution:i,privateCdn:o}},e)}function H(e){return Object.assign({product:ne,sdkCode:ie,sdkSemver:ae,techVersion:de,feature:""},e)}var se=require("@cloudinary-util/url-loader");function v(e,t,n){return(0,se.constructCloudinaryUrl)({options:e,config:L(t),analytics:H(n)})}function Y({loaderOptions:e,imageProps:t,cldOptions:n,cldConfig:i={}}){let o={...t,...n};if(o.width=typeof o.width=="string"?parseInt(o.width):o.width,o.height=typeof o.height=="string"?parseInt(o.height):o.height,typeof e?.width=="number"&&typeof o.width=="number"&&e.width!==o.width){let d=e.width/o.width;o.width=e.width,typeof o.height=="number"&&(o.height=Math.floor(o.height*d))}else typeof e?.width=="number"&&typeof o?.width!="number"&&(o.width=e?.width);return v(o,i)}var Ve=(0,b.forwardRef)(function(t,n){let i=!1,o=["assetType","config","deliveryType","preserveTransformations","strictTransformations"];ue.transformationPlugins.forEach(({props:r})=>{Object.keys(r).forEach(C=>{if(o.includes(C))throw new Error(`Option ${C} already exists!`);o.push(C)})});let d={alt:t.alt,src:t.src};Object.keys(t).filter(r=>typeof r=="string"&&!o.includes(r)).forEach(r=>d[r]=t[r]);let l=Object.keys(d).map(r=>`${r}:${d[r]}`).join(";"),[O,U]=(0,b.useState)(l),a={};if(o.forEach(r=>{let c=t[r];c&&(a[r]=c||void 0)}),t.preserveTransformations)try{let r=(0,ce.getTransformations)(t.src).map(c=>c.join(","));a.rawTransformations=[...r.flat(),...t.rawTransformations||[]]}catch(r){console.warn(`Failed to preserve transformations: ${r.message}`)}let s=process.env.__NEXT_IMAGE_OPTS||{};(t.unoptimized===!0||s?.unoptimized===!0)&&(d.src=v({...a,width:d.width,height:d.height,src:d.src,format:"default",quality:"default"},t.config));async function _(r){let c=!0;if(i)return;if(i=!0,typeof t.onError=="function"){let T=t.onError(r);typeof T=="boolean"&&T===!1&&(c=!1)}else typeof t.onError=="boolean"&&t.onError===!1&&(c=!1);if(c===!1)return;let C=r.target;await B({src:C.src})&&U(`${l};${Date.now()}`)}let N=(0,b.useCallback)(_,[B,l]),y=pe.default;return"default"in y&&(y=y.default),b.default.createElement(y,{key:O,...d,loader:r=>Y({loaderOptions:r,imageProps:d,cldOptions:a,cldConfig:t.config}),onError:N,ref:n})}),q=Ve;var E=h(require("react")),ge=h(require("next/head"));function V(e){return v({...e,format:e.format||"jpg",width:e.width||1200,height:e.height||627,crop:e.crop||{type:"fill",gravity:"center",source:!0}})}var ke="summary_large_image",Ge=({excludeTags:e=[],twitterTitle:t,keys:n={},...i})=>{let{alt:o}=i,{width:d=1200,height:l=627}=i;d=typeof d=="string"?parseInt(d):d,l=typeof l=="string"?parseInt(l):l;let O=V({...i,width:d,height:l}),U=V({...i,width:d,height:l,format:i.format||"webp"}),a={"og:image":"og-image","og:image:secure_url":"og-image-secureurl","og:image:width":"og-image-width","og:image:height":"og-image-height","og:image:alt":"og-image-alt","twitter:title":"twitter-title","twitter:card":"twitter-card","twitter:image":"twitter-image",...n};return E.default.createElement(ge.default,null,E.default.createElement("meta",{key:a["og:image"],property:"og:image",content:O}),E.default.createElement("meta",{key:a["og:image:secure_url"],property:"og:image:secure_url",content:O}),E.default.createElement("meta",{key:a["og:image:width"],property:"og:image:width",content:`${d}`}),E.default.createElement("meta",{key:a["og:image:height"],property:"og:image:height",content:`${l}`}),o&&E.default.createElement("meta",{key:a["og:image:alt"],property:"og:image:alt",content:o}),!e.includes("twitter:title")&&E.default.createElement("meta",{key:a["twitter:title"],property:"twitter:title",content:t||" "}),E.default.createElement("meta",{key:a["twitter:card"],property:"twitter:card",content:ke}),E.default.createElement("meta",{key:a["twitter:image"],property:"twitter:image",content:U}))},Q=Ge;var G=h(require("react"));var g=h(require("react")),fe=h(require("next/script"));function me(e){return window&&"requestIdleCallback"in window?requestIdleCallback(e):setTimeout(()=>e(),1)}var Re=["success"],je={abort:"onAbort","batch-cancelled":"onBatchCancelled",close:"onClose","display-changed":"onDisplayChanged",publicid:"onPublicId","queues-end":"onQueuesEnd","queues-start":"onQueuesStart",retry:"onRetry","show-completed":"onShowCompleted","source-changed":"onSourceChanged",success:"onSuccess",tags:"onTags","upload-added":"onUploadAdded"},$e=({children:e,config:t,onError:n,onOpen:i,onUpload:o,options:d,signatureEndpoint:l,uploadPreset:O,...U})=>{let a=(0,g.useRef)(),s=(0,g.useRef)(),_=!!l,[N,y]=(0,g.useState)(void 0),[r,c]=(0,g.useState)(void 0),[C,x]=(0,g.useState)(!0),T=L(t),{cloudName:A,apiKey:P}=T?.cloud,w={cloudName:A,uploadPreset:O||process.env.NEXT_PUBLIC_CLOUDINARY_UPLOAD_PRESET,apiKey:P,...d};_&&(w.uploadSignature=M,w.apiKey||console.warn("Missing dependency: Signed Upload requires an API key")),(0,g.useEffect)(()=>{if(typeof r>"u")return;r.event==="success"&&typeof o=="function"&&(process.env.NODE_ENVIRONMENT==="development"&&console.warn("The onUpload callback is deprecated. Please use onSuccess instead."),o(r,s.current))},[r]);function R(){x(!1),a.current||(a.current=window.cloudinary),me(()=>{s.current||(s.current=ee())})}(0,g.useEffect)(()=>()=>{s.current?.destroy(),s.current=void 0},[]);function M(p,I){if(typeof l>"u")throw Error("Failed to generate signature: signatureEndpoint undefined.");fetch(l,{method:"POST",body:JSON.stringify({paramsToSign:I}),headers:{"Content-Type":"application/json"}}).then(W=>W.json()).then(({signature:W})=>{p(W)})}function u(p,I=[]){if(s.current||(s.current=ee()),typeof s?.current[p]=="function")return s.current[p](...I)}function S(p){u("close",[p])}function D(p){return u("destroy",[p])}function f(){u("hide")}function j(){return u("isDestroyed")}function Ee(){return u("isMinimized")}function Pe(){return u("isShowing")}function we(){u("minimize")}function _e(p,I){u("open",[p,I]),typeof i=="function"&&i(s.current)}function xe(){u("show")}function Te(){u("update")}let F={close:S,destroy:D,hide:f,isDestroyed:j,isMinimized:Ee,isShowing:Pe,minimize:we,open:_e,show:xe,update:Te};function ee(){return a.current?.createUploadWidget(w,(p,I)=>{if(p&&p!==null&&(y(p),typeof n=="function"&&n(p,{widget:s.current,...F})),typeof I?.event=="string"){Re.includes(I?.event)&&c(I);let W=je[I.event];if(typeof W=="string"&&typeof U[W]=="function"){let Ae=U[W];Ae(I,{widget:s.current,...F})}}})}return g.default.createElement(g.default.Fragment,null,typeof e=="function"&&e({cloudinary:a.current,widget:s.current,results:r,error:N,isLoading:C,...F}),g.default.createElement(fe.default,{id:`cloudinary-uploadwidget-${Math.floor(Math.random()*100)}`,src:"https://upload-widget.cloudinary.com/global/all.js",onLoad:R,onError:p=>console.error(`Failed to load Cloudinary Upload Widget: ${p.message}`)}))},k=$e;var Be=({className:e,children:t,onClick:n,onError:i,onOpen:o,onUpload:d,onAbort:l,onBatchCancelled:O,onClose:U,onDisplayChanged:a,onPublicId:s,onQueuesEnd:_,onQueuesStart:N,onRetry:y,onShowCompleted:r,onSourceChanged:c,onSuccess:C,onTags:x,onUploadAdded:T,options:A,signatureEndpoint:P,uploadPreset:w,...R})=>G.default.createElement(G.default.Fragment,null,G.default.createElement(k,{onError:i,onOpen:o,onUpload:d,onAbort:l,onBatchCancelled:O,onClose:U,onDisplayChanged:a,onPublicId:s,onQueuesEnd:_,onQueuesStart:N,onRetry:y,onShowCompleted:r,onSourceChanged:c,onSuccess:C,onTags:x,onUploadAdded:T,options:A,signatureEndpoint:P,uploadPreset:w},({open:M,isLoading:u})=>{function S(D){D.preventDefault(),M(),typeof n=="function"&&n(D)}return G.default.createElement("button",{...R,className:e||"",onClick:S,disabled:u},t||"Upload")})),J=Be;var m=h(require("react")),Ce=h(require("next/script")),Ie=h(require("next/head")),he=require("@cloudinary-util/url-loader");var X=[],ye="1.11.1",He=e=>{let{className:t,config:n,height:i,id:o,onDataLoad:d,onError:l,onMetadataLoad:O,onPause:U,onPlay:a,onEnded:s,width:_}=e,N=L(n),y=(0,he.getVideoPlayerOptions)(e,N),{publicId:r}=y;if(typeof r>"u")throw new Error("Video Player requires a Public ID or Cloudinary URL - please specify a src prop");let c=(0,m.useRef)(),C=(0,m.useRef)(),x=e.videoRef||C,T=(0,m.useRef)(),A=e.playerRef||T,P=o||`player-${r.replace("/","-")}`,w="cld-video-player cld-fluid";t&&(w=`${w} ${t}`),X.filter(f=>f===P).length>1?console.warn(`Multiple instances of the same video detected on the
     page which may cause some features to not work.
    Try adding a unique id to each player.`):X.push(P);let M={error:l,loadeddata:d,loadedmetadata:O,pause:U,play:a,ended:s};function u(f){let j=M[f.type];typeof j=="function"&&j(D())}function S(){"cloudinary"in window&&(c.current=window.cloudinary,A.current=c.current.videoPlayer(x.current,y),Object.keys(M).forEach(f=>{typeof M[f]=="function"&&A.current?.on(f,u)}))}(0,m.useEffect)(()=>()=>{A.current?.videojs.cloudinary.dispose(),X=X.filter(f=>f!==P)},[]);function D(){return{player:A.current,video:x.current}}return m.default.createElement(m.default.Fragment,null,m.default.createElement(Ie.default,null,m.default.createElement("link",{href:`https://unpkg.com/cloudinary-video-player@${ye}/dist/cld-video-player.min.css`,rel:"stylesheet"})),m.default.createElement("div",{style:{width:"100%",aspectRatio:`${_} / ${i}`}},m.default.createElement("video",{ref:x,id:P,className:w,width:_,height:i}),m.default.createElement(Ce.default,{id:`cloudinary-videoplayer-${P}-${Math.floor(Math.random()*100)}`,src:`https://unpkg.com/cloudinary-video-player@${ye}/dist/cld-video-player.min.js`,onLoad:S,onError:f=>console.error(`Failed to load Cloudinary Video Player: ${f.message}`)})))},Z=He;var Oe=require("@cloudinary-util/url-loader");function Ue(e,t,n){return(0,Oe.constructCloudinaryUrl)({options:{assetType:"video",format:"auto:video",...e},config:L(t),analytics:H(n)})}0&&(module.exports={CldImage,CldOgImage,CldUploadButton,CldUploadWidget,CldVideoPlayer,cloudinaryLoader,getCldImageUrl,getCldOgImageUrl,getCldVideoUrl});
//# sourceMappingURL=index.js.map